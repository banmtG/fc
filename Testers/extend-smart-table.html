<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">  
  <title>Extended SmartTable Demo</title>

  <!-- Extended smart-table -->
  <script type="module" src="./../components/smart/extended-smart-table/extended-smart-table.js"></script>
  <script type="text/javascript" src="./phraseList.js"></script>
</head>
<body>
  <extended-smart-table id="extTbl" search="true" pagination="10,20,50,100,all"></extended-smart-table>

  <script type="module">
    import "./../components/smart/star-rating.js";
    import { mapTableData, formatTimestamp } from "./../components/smart/smart-table/utils/mapTableData.js";

    const extTbl = document.getElementById("extTbl");

    // Host prepares raw data (no mapTableData here)
    extTbl.data = mapTableData(tableData);

    // Pass down columns
    extTbl.setColumns([
      { key: "phrase", label: "Phrase", width: "3fr" },
      { key: "status", label: "Status", width: "2fr" },
      {
        key: "_actions",
        sortable: false,
        label: "Actions",
        width: "2fr",
        interactive: true,
        render: (_, obj) => {
          const div = document.createElement("div");
          div.className = "actions";
          div.innerHTML = `
            <button class="btn btn-edit" data-id="${obj.id}">âœï¸</button>
            <button class="btn btn-delete" data-id="${obj.id}">ğŸ—‘ï¸</button>
          `;
          return div;
        },
        events: {
          click: (e, row, obj) => {
            if (e.target.classList.contains("btn-edit")) {
              row.dispatchEvent(new CustomEvent("edit-requested", {
                detail: { id: obj.id },
                bubbles: true,
                composed: true
              }));
            }
            if (e.target.classList.contains("btn-delete")) {
              const msg = "Are you sure you want to delete this row?";
              if (confirm(msg)) {
                row.dispatchEvent(new CustomEvent("delete-requested", {
                  detail: { ids: obj.id },
                  bubbles: true,
                  composed: true
                }));
              }
            }
          }
        }
      },
      {
        key: "rating",
        label: "Stars",
        width: "2fr",
        interactive: true,
        render: (val, obj) => {
          const rating = document.createElement("star-rating");
          rating.rating = val;
          rating.id = obj.id;
          rating.setAttribute("row-id", obj.id);
          return rating;
        }
      },
      {
        key: "phrase",
        label: "Reminder",
        width: "2fr",
        interactive: true,
        render: (val, obj) => {
          const input = document.createElement("input");
          input.type = "text";
          input.value = val || "";
          input.addEventListener("input", e => {
            input.dispatchEvent(new CustomEvent("interactive-component-changed", {
              detail: { id: obj.id, field: "note", value: e.target.value },
              bubbles: true,
              composed: true
            }));
          });
          return input;
        }
      }
    ]);


    extTbl._runPipeline();
    // Listen to generic events
    // extTbl.addEventListener("interactive-component-changed", e => {
    //   console.log("Interactive change:", e.detail);
    //   // Example: { id: "123", field: "rating", value: 4 }
    // });
  </script>
</body>
</html>
