<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">  
  <title>Extended SmartTable Demo</title>

  <!-- Extended smart-table -->
  <script type="module" src="./../components/smart/extended-smart-table/extended-smart-table.js"></script>
  <script type="text/javascript" src="./phraseList.js"></script>
</head>
<body>
  <extended-smart-table id="extTbl" search="true" pagination="10,20,50,100,all"></extended-smart-table>

  <script type="module">
    import "./../components/smart/star-rating.js";
    import { mapTableData, formatTimestamp } from "./../components/smart/smart-table/utils/mapTableData.js";

    const extTbl = document.getElementById("extTbl");

    // Host prepares raw data (no mapTableData here)
    extTbl.data = mapTableData(tableData);

    // Pass down columns
    extTbl.setColumns([
      {
    key: "order",
    label: "No",
    interactive: false,
    width_set: { value: "auto", resizable: false },  
    render: (val, obj) => {
      const span = document.createElement("span");
      span.textContent = val;
      // defer until after append
      console.log(obj);
      setTimeout(() => {
        if (span.parentNode) {
          span.parentNode.style.justifyContent = "center";
          if (obj.orderBgcolor) {
            span.parentNode.style.backgroundColor = obj.orderBgcolor.bgColor;
            span.parentNode.style.color = obj.orderBgcolor.color;
          }
        }
      });
      return span;
    }
  },
  {
    key: "phrase",
    label: "Phrase",
    width_set: {
      value: "4fr",      // fit content width
      min: "100px",
      resizable: true     // allow drag resizing
    }
  },
  {
    key: "status",
    label: "S",
    width_set: {
      value: "25px",      // fit content width
      resizable: false     // allow drag resizing
    },
    render: (val, obj) => {
      const div = document.createElement("div");      
      div.style.width = "100%;"
      div.style.height = "100%;"
      // defer until after append
      setTimeout(() => {
        if (div.parentNode) {
          div.parentNode.style.backgroundColor = obj.statusBgColor.bgColor;
          div.parentNode.style.color = obj.statusBgColor.color;
        }
      });
      return div;
    }
  },
  {
    key: "_actions",
    sortable: false,
    label: "Actions",
    width_set: {       
      value: "auto",      // fit content width
      resizable: false
    },
    interactive: true,
    render: (_, obj) => {
      const div = document.createElement("div");
      div.className = "actions";
      div.innerHTML = `
        <button class="btn btn-edit" data-id="${obj.id}">âœï¸</button>
        <button class="btn btn-delete" data-id="${obj.id}">ğŸ—‘ï¸</button>
      `;
      return div;
    },
    events: {
      click: (e, row, obj) => {
        if (e.target.classList.contains("btn-edit")) {
          row.dispatchEvent(new CustomEvent("edit-requested", {
            detail: { id: obj.id },
            bubbles: true,
            composed: true
          }));
        }
        if (e.target.classList.contains("btn-delete")) {
          const msg = "Are you sure you want to delete this row?";
          if (confirm(msg)) {
            row.dispatchEvent(new CustomEvent("delete-requested", {
              detail: { ids: obj.id },
              bubbles: true,
              composed: true
            }));
          }
        }
      }
    }
  }
  // {
  //   key: "rating",
  //   label: "Stars",
  //   interactive: true,
  //   width_set: {
  //     value: "auto",      // fit content width
  //     resizable: true     // allow drag resizing
  //   },
  //   render: (val, obj) => {
  //     const rating = document.createElement("star-rating");
  //     rating.rating = val;
  //     rating.id = obj.id;
  //     rating.setAttribute("row-id", obj.id);
  //     return rating;
  //   }
  // },
  


  // {
  //   key: "phrase",
  //   label: "Reminder",
  //   interactive: true,
  //   width_set: {
  //     value: "auto",      
  //     resizable: false
  //   },
  //   render: (val, obj) => {
  //     const input = document.createElement("input");
  //     input.type = "text";
  //     input.value = val || "";
  //     input.addEventListener("input", e => {
  //       input.dispatchEvent(new CustomEvent("interactive-component-changed", {
  //         detail: { id: obj.id, field: "phrase", value: e.target.value },
  //         bubbles: true,
  //         composed: true
  //       }));
  //     });
  //     return input;
  //   }
  // }
]);

    extTbl._sortState = { key:"status", dir:"asc" };
    extTbl._pageSize = extTbl.data.length;
    extTbl.$pageSize.value = "all";
    extTbl._onPageSize({ target : { value : "all"}});

    //extTbl._runPipeline();
    // Listen to generic events
    // extTbl.addEventListener("interactive-component-changed", e => {
    //   console.log("Interactive change:", e.detail);
    //   // Example: { id: "123", field: "rating", value: 4 }
    // });
  </script>
</body>
</html>
