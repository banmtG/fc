<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">  

  <title>SmartTable Demo</title>
  <script type="module" src="./../components/smart/smart-table/smart-table.js"></script>
  <script type="text/javascript" src="./phraseList.js"></script>
</head>
<body>
  <smart-table id="tbl"></smart-table>
  <script type="module">

    import { mapTableData, formatTimestamp } from "./../components/smart/smart-table/utils/mapTableData.js";
    import "./../components/smart/star-rating.js"
    const cookedData = mapTableData(tableData);
    const tbl = document.getElementById("tbl");
    setTimeout(() => {
      tbl.data = cookedData.slice(0,20);
      tbl.columns = [
        { key: "phrase", label: "Phrase", width: "3fr" },
        { key: "status", label: "Status", width: "2fr" },
        {
        key: "_actions",
        sortable: false, 
        label: "Actions",
        width: "2fr",
        interactive: true, // manages its own UI
        render: (_, obj) => {
          const div = document.createElement("div");
          div.className = "actions";
          div.innerHTML = `
            <button class="btn btn-edit" data-id="${obj.id}">âœï¸</button>
            <button class="btn btn-delete" data-id="${obj.id}">ğŸ—‘ï¸</button>
          `;
          return div;
        },
        events: {
          click: (e, row, obj) => {
            if (e.target.classList.contains("btn-edit")) {
              row.dispatchEvent(
                  new CustomEvent("row-edit", { detail: { id: obj.id }, 
                  bubbles: true,
                  composed: true
                }));
            }
            if (e.target.classList.contains("btn-delete")) {
              const msg = "Are you sure you want to delete this row?";
              if (confirm(msg)) {
                row.dispatchEvent(new CustomEvent("row-delete", {
                  detail: { id: obj.id },
                  bubbles: true,
                  composed: true
                }));
              }
            }
          }
        }
      },
      {
        key: "rating",
        label: "Stars",
        width: "2fr",
        interactive: true, // manages its own UI
        render: (val, obj) => {
          const rating = document.createElement("star-rating");
          rating.rating = val;
          rating.id = obj.id;          // set via property
          rating.setAttribute("row-id", obj.id); // also as attribute for robustness
          return rating;
        }
      },
        {
          key: "phrase",
          label: "Reminder",
          width: "2fr",
          interactive: true, // manages its own UI
          render: (val) => {
            const input = document.createElement("input");
            input.type = "text";
            input.value = val || "";
            return input;
          },
          events: {
            input: (e, row) => {
              row.dispatchEvent(new CustomEvent("row-note", {
                detail: { id: row.dataset.phraseID, note: e.target.value },
                bubbles: true,
                composed: true
              }));
            }
          }
        }
      ];

    tbl._renderInitial();
    }, 1000);
  

    // Add a row
    setTimeout(() => {
      tbl.addRow(cookedData[cookedData.length-2]);
    }, 1000);
  

    // setTimeout(() => {
    //   tbl.selectRows([4, 2], false); // clears previous, selects only 4 and 5
    
    // }, 4000);


    tbl.addEventListener("row-edit", e => console.log("Edit", e.detail)); 
    tbl.addEventListener("row-delete", e => console.log("Delete", e.detail)); 
    tbl.addEventListener("row-multi-delete", e => console.log("Multi-delete", e.detail)); 
    tbl.addEventListener("highlight-changed", e => console.log("Move", e.detail)); 
    tbl.addEventListener("row-selected", e => console.log("Selected", e.detail)); 

    tbl.addEventListener("row-delete", e => {
      const { id } = e.detail;
      // actually remove the row from your data
      tbl.deleteRow(id);
    });

    tbl.addEventListener("row-edit", e => {
      const { id } = e.detail;
      // open edit dialog, etc.
      console.log("Edit row", id);
    });

tbl.addEventListener("rating-changed", e => {
  const { id, rating } = e.detail;
  tbl.updateRow(id, { rating });
});




    tbl.addEventListener("row-note", e => {
      const { id, note } = e.detail;
      console.log(`Row ${id} note changed to: ${note}`);
    });


// tbl.addEventListener("row-multi-selected", e => console.log("Multi selected", e.detail));
// External selection setTimeout(() => tbl.selectRow(2), 2000);
  </script>
</body>
</html>
